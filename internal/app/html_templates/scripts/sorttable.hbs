<script>

    window.addEventListener('load', () => {
        let target = document.querySelector('.target'),
            source = document.querySelector('.source');

        new gridjs.Grid({
            sort: true,
            {{#if search }}
            search: true,
            {{/if}}
            columns: Array.from(source.querySelectorAll('thead th')).map(th => th.textContent).map(head => ({
                name: head,
                formatter: (cell) => gridjs.html(cell),

                sort: {
                    compare: (a, b) => {
                        var strip = (str) => new DOMParser().parseFromString(str, 'text/html').body.textContent || '',
                            a = strip(a),
                            b = strip(b);
                        if (a > b) {
                            return 1;
                        } else if (b > a) {
                            return -1;
                        } else {
                            return 0;
                        }
                    }
                }
            })),
            data: Array.from(source.querySelectorAll('tbody tr')).map(tr => Array.from(tr.querySelectorAll('td')).map(td => td.innerHTML)),
        }).render(target);

        // Set source to be display none
        source.style.display = 'none';
    }) //, 1500);
</script>